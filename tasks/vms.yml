---
# Setup vmware vms

- block:
    - include_tasks: vms_fact.yml
      when: >-
        (vmware_provisioner_gather_inventory_vm_configs
         and (vmware_provisioner_inventory_vms is not defined
              or vmware_provisioner_gather_inventory_vm_configs_force))
        or (vmware_provisioner_gather_detailed_vm_fact
            and (vmware_provisioner_vms_detailed_fact is not defined
                 or vmware_provisioner_gather_vm_fact_force))

    - block:
        - include_tasks: >-
            vms_{{ vmware_provisioner_vms_provisioning_method }}.yml

        - include_tasks: >-
            vms_disks_{{ vmware_provisioner_vms_provisioning_method }}.yml
          tags:
            - role::vmware_provisioner::vms::disks
      when:
        - vmware_provisioner_vms | length > 0
        - vmware_provisioner_provisione | bool
  tags:
    - role::vmware_provisioner
    - role::vmware_provisioner::vms
